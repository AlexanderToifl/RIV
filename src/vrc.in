# Variables, Random atoms and Changing velocity of individual atoms (VRC)

units 		metal

variable temp_lower equal 300.
variable temp_upper equal 400.
variable massvar 	equal 28.09

variable unit_cell equal 4

boundary 	p p p
atom_style	atomic

neighbor 		0.3 bin
neigh_modify	delay 1

lattice			diamond 5.432

region			base block 0 ${unit_cell} 0 ${unit_cell} 0 ${unit_cell} units lattice
create_box		1 base
create_atoms	1 region base

#use Stillinger - Weber Potential to generate a-Si

mass			1 ${massvar}
pair_style		sw
pair_coeff		* * Si.sw Si

#Melting Step

fix 			1 all nve
fix 			2 all temp/berendsen ${temp_lower} ${temp_upper} 0.1
#fix 			5 all press/berendsen iso 1.0 40000.0 1000.0

reset_timestep 0
timestep		0.001

dump			8 all atom 100 dump.vrc5

thermo_style custom step lx ly lz press pxx pyy pzz pe atoms temp 
thermo			100
thermo_modify	lost ignore flush yes

run 5000
unfix 2


variable tmp equal "lx"
variable tmp1 equal "temp"

variable L0 equal ${tmp}
variable T0 equal ${tmp1}
print "Initial Length, L0: ${L0}"
print "Temperature after Melting Step, T0: ${T0}"
print "Temperature T: ${tmp1}"



#Equilibration
run 4000

variable ekin equal 500				#eV
variable vel equal "(2*v_ekin/v_massvar)^(1./2.)"
variable v0 equal ${vel}

print "Velocity v: ${v0}"

variable tmp2 equal "atoms"

variable i loop 3

#Start loop

label loop
dump 1 all atom 100 testfile.$i

### Calculate velocity components (finally working but far from elegant)

variable vx equal random(0,${vel},5974)
variable v1 equal ${vx}
variable vtemp1 equal "(v_v0^2 - v_v1^2)^(1./2.)"
variable vy equal random(0,${vtemp1},8795)
variable v2 equal ${vy}
variable vz equal "(v_v0^2 - v_v1^2 - v_v2^2)^(1./2.)"
print "Velocity vx: ${v1}"
print "Velocity vy: ${v2}"
print "Velocity vz: ${vz}"

#choose random atom 
variable rn_id equal floor(random(0,${tmp2},30491))
print "Random id: ${rn_id}"

#define group that contains the chosen atom
group ${i} id ${rn_id}
velocity ${i} set ${v1} ${v2} ${vz}
#velocity matoms scale 100 <-- does not work

run 4000

undump 1
next i
jump vrc.in loop


#deform in x direction

fix		3 all deform 1 x scale 0.8 remap x


variable strain equal "(lx - v_L0)/v_L0"
variable p1 equal "v_strain"
variable p2 equal "-pxx/10000"
variable p3 equal "-pyy/10000"
variable p4 equal "-pzz/10000"
fix def1 all print 100 "${p1} ${p2} ${p3} ${p4}" file x_compression.txt screen no


run 1000
unfix 3

#deform in y direction

fix		3 all deform 1 y scale 0.8 remap x

variable strain equal "(ly - v_L0)/v_L0"
variable p1 equal "v_strain"
variable p2 equal "-pxx/10000"
variable p3 equal "-pyy/10000"
variable p4 equal "-pzz/10000"
fix def1 all print 100 "${p1} ${p2} ${p3} ${p4}" file y_compression.txt screen no

run 1000
unfix 3

run 5000

